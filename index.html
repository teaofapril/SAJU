<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>운명의 기록 : AI 사주 솔루션</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
    <style>
        :root { 
            --dark-bg: #000000; 
            --card-bg: rgba(10, 10, 10, 0.85); 
            --accent: #ffffff; 
            --text: #e0e0e0; 
        }

        body { 
            margin: 0;
            padding: 40px 20px;
            background-color: var(--dark-bg); 
            /* 은은하고 거대한 용의 실루엣 배경 */
            background-image: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), 
                              url('https://images.unsplash.com/photo-1615678815958-5910c6811c25?q=80&w=2000');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: var(--text); 
            font-family: 'Pretendard', sans-serif; 
            display: flex; 
            justify-content: center; 
        }

        .container { max-width: 800px; width: 100%; position: relative; z-index: 1; }

        h1 { 
            color: #ffffff; 
            text-align: center; 
            margin-bottom: 40px; 
            letter-spacing: 8px; 
            font-weight: 200;
            text-transform: uppercase;
        }

        .input-card { 
            background: var(--card-bg); 
            padding: 40px; 
            border-radius: 0px; /* 각진 디자인으로 더 고급스럽게 */
            border: 1px solid #333; 
            margin-bottom: 30px; 
            text-align: center;
            backdrop-filter: blur(15px);
        }

        .input-group label { 
            display: block; 
            margin-bottom: 25px; 
            color: #fff; 
            font-size: 1rem;
            letter-spacing: 2px;
        }

        input[type="date"], input[type="time"] { 
            padding: 12px; 
            border-radius: 0; 
            border: 1px solid #444; 
            background: rgba(255,255,255,0.05); 
            color: #fff; 
            font-size: 1rem; 
            margin: 5px;
            outline: none;
        }

        button { 
            width: 100%; 
            max-width: 300px;
            padding: 15px; 
            background: none; 
            border: 1px solid #fff; 
            color: #fff; 
            font-weight: bold; 
            cursor: pointer; 
            font-size: 0.9rem; 
            transition: all 0.5s; 
            margin-top: 20px;
            letter-spacing: 3px;
        }

        button:hover { 
            background: #fff; 
            color: #000;
        }

        #result { 
            background: var(--card-bg); 
            padding: 40px; 
            display: none; 
            line-height: 2.2; 
            white-space: pre-wrap; 
            border: 1px solid #333; 
            margin-top: 20px;
            backdrop-filter: blur(20px);
        }

        .saju-box { 
            padding: 15px; 
            border: 1px solid rgba(255,255,255,0.3); 
            color: #ffffff; 
            margin-bottom: 30px; 
            text-align: center;
            letter-spacing: 3px;
        }

        .loading { text-align: center; display: none; color: #fff; margin: 20px 0; letter-spacing: 2px; }
    </style>
</head>
<body>

<div class="container">
    <h1>DESTINY LOG</h1>
    
    <div class="input-card">
        <div class="input-group">
            <label>생년월일시를 입력하십시오</label>
            <input type="date" id="birthDate">
            <input type="time" id="birthTime">
        </div>
        <div style="margin: 15px 0; font-size: 0.8rem; color: #666;">
            <input type="checkbox" id="noTime" onchange="document.getElementById('birthTime').disabled = this.checked"> 
            <label for="noTime" style="cursor:pointer;">시간을 모름</label>
        </div>
        <button onclick="runAnalysis()">ANALYZE</button>
    </div>

    <div id="loading" class="loading">해독 중...</div>
    <div id="result"></div>
</div>

<script>
    const RENDER_SERVER_URL = "https://saju-backend-6c73.onrender.com/analyze";

    window.runAnalysis = async function() {
        const dateInput = document.getElementById('birthDate').value;
        const timeInput = document.getElementById('birthTime').value;
        const noTime = document.getElementById('noTime').checked;
        const resultDiv = document.getElementById('result');
        const loading = document.getElementById('loading');

        if (!dateInput) return alert("날짜를 선택하십시오.");
        loading.style.display = 'block';
        resultDiv.style.display = 'none';

        try {
            const [y, m, d] = dateInput.split('-').map(Number);
            let hh = 0, mm = 0;
            if (!noTime) [hh, mm] = timeInput.split(':').map(Number);

            const solar = Solar.fromYmdHms(y, m, d, hh, mm, 0);
            const eightChar = solar.getLunar().getEightChar();
            const sajuStr = `[年] ${eightChar.getYear()}${eightChar.getYearZhi()} [月] ${eightChar.getMonth()}${eightChar.getMonthZhi()} [日] ${eightChar.getDay()}${eightChar.getDayZhi()} [時] ${noTime ? '不明' : eightChar.getTimeGan() + eightChar.getTimeZhi()}`;

            const response = await fetch(RENDER_SERVER_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ sajuStr: sajuStr })
            });

            const data = await response.json();
            resultDiv.innerHTML = `<div class="saju-box">${sajuStr}</div>` + data.text.replace(/## /g, '<h2 style="color:#fff; border-bottom:1px solid #333; padding-bottom:10px;">').replace(/##/g, '');
            resultDiv.style.display = 'block';
        } catch (e) {
            alert("연결 실패. 다시 시도하십시오.");
        } finally {
            loading.style.display = 'none';
        }
    }
</script>
</body>
</html>
