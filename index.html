<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DESTINY LOG - 사주 분석</title>
    <style>
        /* 치코리타님을 위한 블랙 & 화이트 세련된 디자인 */
        body { 
            background: #000; 
            color: #fff; 
            text-align: center; 
            font-family: 'Pretendard', sans-serif; 
            padding-top: 50px; 
            margin: 0;
        }
        .container { 
            border: 1px solid #333; 
            padding: 40px 20px; 
            display: inline-block; 
            background: #111; 
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255,255,255,0.05);
        }
        h1 { font-size: 2rem; letter-spacing: 5px; margin-bottom: 30px; }
        .input-group { margin-bottom: 20px; }
        input { 
            background: #222; 
            border: 1px solid #444; 
            color: #fff; 
            padding: 12px; 
            margin: 5px; 
            border-radius: 5px;
            font-size: 1rem;
        }
        button { 
            padding: 15px 40px; 
            cursor: pointer; 
            background: #fff; 
            border: none; 
            font-weight: bold; 
            letter-spacing: 2px;
            margin-top: 10px;
            transition: 0.3s;
        }
        button:hover { background: #ccc; }
        #loading { margin-top: 20px; color: #888; display: none; }
        #result { 
            margin-top: 30px; 
            white-space: pre-wrap; 
            text-align: left; 
            max-width: 600px; 
            line-height: 1.8;
            padding: 20px;
            border-top: 1px solid #333;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>DESTINY LOG</h1>
        <div class="input-group">
            <input type="date" id="d">
            <input type="time" id="t">
            <p style="font-size: 0.8rem; color: #666;">*시간을 모르면 날짜만 입력 후 ANALYZE를 누르세요.</p>
        </div>
        <button onclick="ask()">ANALYZE</button>
        <div id="loading">✨ 우주의 기운을 모아 분석 중입니다...</div>
        <div id="result"></div>
    </div>

    <script>
        async function ask() {
            const dateInput = document.getElementById('d').value;
            const timeInput = document.getElementById('t').value;
            
            if(!dateInput) {
                alert("생년월일을 먼저 선택해주세요!");
                return;
            }
            
            // ✅ 시간을 입력하지 않았을 때 처리 로직
            const finalTime = timeInput ? timeInput : "시간 모름 (삼주 분석 요청)";
            const fullSajuStr = `생년월일: ${dateInput}, 시간: ${finalTime}`;

            const loadingDiv = document.getElementById('loading');
            const resultDiv = document.getElementById('result');

            loadingDiv.style.display = 'block';
            resultDiv.innerText = '';

            try {
                // ✅ 아까 만든 새 서버(saju-tier1-api) 주소입니다.
                const response = await fetch("https://saju-tier1-api.onrender.com/analyze", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ sajuStr: fullSajuStr })
                });

                const data = await response.json();
                
                if(data.text) {
                    resultDiv.innerText = data.text;
                } else {
                    resultDiv.innerText = "분석 내용을 가져오지 못했습니다. 다시 시도해 주세요.";
                }
            } catch (error) {
                console.error("Error:", error);
                alert("서버 연결에 실패했습니다. (에러: " + error.message + ")");
            } finally {
                loadingDiv.style.display = 'none';
            }
        }
    </script>
</body>
</html>
